#!/bin/bash

IGNORE_LIST=$HOME/.config/backup/ignorelist
BACKUP_DIR=$HOME/.backups

[ ! -v EMAIL ] && echo "Please set environment variable: EMAIL" && exit 1

rsync -aP --exclude-from=$IGNORE_LIST $HOME /tmp/backup/

echo "Creating tar archive..."

BACKUP_FILENAME="backup-$EMAIL-$(date +"%Y-%m-%d-%H-%M").tar"
tar cf "/tmp/$BACKUP_FILENAME" /tmp/backup

echo "Encrypting tar file..."

gpg --output "$BACKUP_DIR/$BACKUP_FILENAME.gpg" --encrypt --recipient $GPG_KEY_ID "/tmp/$BACKUP_FILENAME"

[ -d "/media/$USER/KINGSTON/backups" ] && echo "Copying to flash drive..." && rsync -aP "$BACKUP_DIR/" /media/sotiris/KINGSTON/backups-work
